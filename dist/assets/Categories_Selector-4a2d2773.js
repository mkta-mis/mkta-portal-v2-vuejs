import{_ as S,r as i,o as c,e as v,w as s,b as l,g,f as r,t as C,i as M,j as I,v as L,a as u,c as h,F as V,d as T,n as N}from"./index-a03fb613.js";const R={emits:["change","close"],props:{isDialog:{default:!1,type:Boolean},pageTitle:{default:"File Upload",type:String},isMultiple:{default:!1,type:Boolean},isSelectMultiple:{default:!1,type:Boolean},Configuration:{default:{accepts:"image/png, image/jpeg, image/bmp",label:"Upload Image",placeholder:"Pick an Image",icon:"mdi-file-image",searchType:"image"},type:Object}},data(){return{isSaving:!0,maxCount:0,curCount:0,showImage:!1,showDialog:!1,selectedOptions:1,files:{selectedContent:[],selectedKey:[],contents:[],search:""},data:[],paginate:[],curPage:1,chunkSize:10}},components:{},setup(){},created(){this.searchFiles()},mounted(){},methods:{set_Paginate(t){this.paginate=[];for(let e=0;e<t.length;e+=this.chunkSize)this.paginate.push(t.slice(e,e+this.chunkSize));this.curPage=1},fileSelection(t){if(this.isSelectMultiple){let e=this.files.selectedKey.indexOf(t.id);e!=-1?(this.files.selectedContent.splice(e,1),this.files.selectedKey.splice(e,1)):(this.files.selectedContent.push(t),this.files.selectedKey.push(t.id))}else this.files.selectedContent=t,this.files.selectedKey=[],this.files.selectedKey.push(t.id)},searchFiles(){this.$axios.post(this.$serverURL+"api/files/search",{title:this.files.search,type:this.Configuration.searchType}).then(t=>{t.data.code==200&&(this.files.contents=t.data.results,this.set_Paginate(this.files.contents))}).catch(t=>{})},uploadFile(t){let e=new FormData;e.append("tokenString",localStorage.getItem("userToken")),e.append("image",t),this.$axios.post(this.$serverURL+"api/files/upload",e,{headers:{"Content-Type":"multipart/form-data"}}).then(a=>{console.log(a.data),this.curCount++,this.curCount>=this.maxCount&&(this.searchFiles(),this.$refs.uploadFile.value=null)}).catch(a=>{this.curCount++})},singleUpload(t){this.maxCount=1,this.curCount=0,this.uploadFile(t.target.files[0])},multipleUpload(t){this.maxCount=t.target.files.length,this.curCount=0;for(let e=0;e<t.target.files.length;e++){const a=t.target.files[e];this.uploadFile(a)}}}},A={key:0,class:"text-left"},E=u("th",{class:"text-left"}," Filename ",-1),q=u("th",{class:"text-left"}," Type ",-1),G=["onClick"],H={key:0};function J(t,e,a,U,n,d){const _=i("v-spacer"),f=i("v-btn"),p=i("v-card-actions"),b=i("v-card-title"),x=i("v-tab"),K=i("v-tabs"),O=i("v-file-input"),F=i("v-progress-linear"),m=i("v-card-text"),y=i("v-card"),k=i("v-window-item"),P=i("v-text-field"),w=i("v-icon"),D=i("v-img"),B=i("v-table"),z=i("v-pagination"),j=i("v-window");return c(),v(y,{class:"bg-white h-100"},{default:s(()=>[a.isDialog?(c(),v(p,{key:0,"fixed-header":""},{default:s(()=>[l(_),l(f,{fab:"",icon:"mdi-close",class:"bg-danger text-white",onClick:e[0]||(e[0]=o=>t.$emit("close"))})]),_:1})):g("",!0),l(b,{"fixed-header":""},{default:s(()=>[r(C(a.pageTitle),1)]),_:1}),l(m,null,{default:s(()=>[l(K,{modelValue:n.selectedOptions,"onUpdate:modelValue":e[1]||(e[1]=o=>n.selectedOptions=o),class:"mb-3"},{default:s(()=>[l(x,{value:1},{default:s(()=>[r("Via Upload")]),_:1}),l(x,{value:2},{default:s(()=>[r("Via File Vault")]),_:1})]),_:1},8,["modelValue"]),l(j,{modelValue:n.selectedOptions,"onUpdate:modelValue":e[7]||(e[7]=o=>n.selectedOptions=o)},{default:s(()=>[l(k,{value:1},{default:s(()=>[l(y,null,{default:s(()=>[l(m,null,{default:s(()=>[l(O,{multiple:a.isMultiple,accept:a.Configuration.accepts,label:a.Configuration.label,placeholder:a.Configuration.placeholder,"prepend-icon":a.Configuration.icon,disabled:n.curCount<n.maxCount,ref:"uploadFile",loading:n.curCount<n.maxCount,"single-line":"","show-size":"",onChange:e[2]||(e[2]=o=>a.isMultiple?d.multipleUpload(o):d.singleUpload(o))},null,8,["multiple","accept","label","placeholder","prepend-icon","disabled","loading"]),l(F,{class:"rounded",height:15,color:"green",max:n.maxCount,"model-value":n.curCount},null,8,["max","model-value"])]),_:1})]),_:1})]),_:1}),l(k,{value:2},{default:s(()=>[l(y,null,{default:s(()=>[l(m,null,{default:s(()=>[l(P,{"prepend-icon":"mdi-magnify","persistent-hint":"",hint:"Search",modelValue:this.files.search,"onUpdate:modelValue":e[3]||(e[3]=o=>this.files.search=o),onKeyup:M(d.searchFiles,["enter"])},null,8,["modelValue","onKeyup"]),l(f,{class:"my-1",size:"small",onClick:e[4]||(e[4]=()=>{n.files.search="",d.searchFiles()})},{default:s(()=>[l(w,{class:"me-2"},{default:s(()=>[r("mdi-refresh")]),_:1}),r("Refresh")]),_:1})]),_:1}),a.isDialog?(c(),v(p,{key:0},{default:s(()=>[l(_),I(l(f,{onClick:e[5]||(e[5]=()=>{t.$emit("change",n.files.selectedContent)}),class:"bg-success"},{default:s(()=>[l(w,{class:"me-1"},{default:s(()=>[r("mdi-content-save")]),_:1}),r("Proceed")]),_:1},512),[[L,n.files.selectedContent!=null]])]),_:1})):g("",!0),l(m,null,{default:s(()=>[l(B,{density:"compact",class:"border p-1","fixed-header":""},{default:s(()=>[u("thead",null,[u("tr",null,[this.Configuration.searchType=="image"?(c(),h("th",A)):g("",!0),E,q])]),u("tbody",null,[(c(!0),h(V,null,T(n.paginate[n.curPage-1],o=>(c(),h("tr",{onClick:Y=>d.fileSelection(o),class:N(this.files.selectedKey.indexOf(o.id)!=-1?"bg-secondary":"")},[this.Configuration.searchType=="image"?(c(),h("td",H,[l(D,{src:t.$serverURL+"resources/"+o.filename},null,8,["src"])])):g("",!0),u("td",null,C(o.title),1),u("td",null,C(o.type),1)],10,G))),256))])]),_:1})]),_:1}),l(m,null,{default:s(()=>[l(z,{modelValue:n.curPage,"onUpdate:modelValue":e[6]||(e[6]=o=>n.curPage=o),length:n.paginate.length,"total-visible":7},null,8,["modelValue","length"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})}const $=S(R,[["render",J]]),Q={emits:["selected"],props:{tree:{type:Object,default:[]},main:{type:Object}},data(){return{isSelected:!1,finalTree:[]}},components:{},setup(){},watch:{tree(){this.finalTree=this.tree}},created(){},mounted(){},methods:{child_selected(t){this.finalTree=[],Array.isArray(t)?t.forEach(e=>{this.finalTree.push(e)}):this.finalTree.push(t),this.finalTree.push(this.main.parent_id),this.$emit("selected",this.finalTree)}}},W={class:"ms-3 border-start"};function X(t,e,a,U,n,d){const _=i("v-btn"),f=i("Categories_Selector",!0);return c(),h("div",W,[l(_,{onClick:e[0]||(e[0]=p=>d.child_selected(a.main.id)),flat:"","prepend-icon":this.tree.indexOf(this.main.id)!=-1?"mdi-checkbox-marked":"mdi-checkbox-blank-outline"},{default:s(()=>[r(C(a.main.name),1)]),_:1},8,["prepend-icon"]),u("div",null,[(c(!0),h(V,null,T(a.main.full_data,(p,b)=>(c(),v(f,{tree:this.tree,main:p,onSelected:d.child_selected},null,8,["tree","main","onSelected"]))),256))])])}const ee=S(Q,[["render",X]]);export{ee as C,$ as F};
